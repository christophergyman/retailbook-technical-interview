#!/usr/bin/env bash
set -euo pipefail

echo "==> Installing dependencies..."
npm install

echo "==> Running tests..."
npm test

echo "==> Pushing DB schema..."
npm run db:push

echo "==> Seeding database..."
DB_PATH="packages/db/local.db"
if sqlite3 "$DB_PATH" "SELECT COUNT(*) FROM users;" 2>/dev/null | grep -q '^0$' || [ ! -f "$DB_PATH" ]; then
  npm run db:seed
else
  echo "    Database already seeded, skipping."
fi

echo "==> Building project..."
npm run build

echo "==> Starting application..."
npm run --prefix apps/web start
